<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>{{ pet.name }}çš„æ¡£æ¡ˆ</title>
    <!-- å¤ç”¨ä¸»é¡µçš„åŸºç¡€æ ·å¼åº“ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        body { background-color: #f2f4f7; padding-bottom: 50px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }

        /* === æ²‰æµ¸å¼å¤´éƒ¨ === */
        .pet-header {
            height: 280px;
            background-image: url('{{ pet.cover_url }}');
            background-size: cover;
            background-position: center;
            position: relative;
        }
        /* æ¸å˜é®ç½©ï¼Œä¸ºäº†çœ‹æ¸…ä¸Šé¢çš„å­— */
        .pet-header::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.6));
        }

        .header-content {
            position: absolute; bottom: 30px; left: 20px; right: 20px; z-index: 2; color: white;
            display: flex; align-items: flex-end; justify-content: space-between;
        }

        .pet-name { font-size: 32px; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.3); line-height: 1;}
        .pet-meta { font-size: 14px; opacity: 0.9; margin-top: 5px; font-weight: 500; }

        /* æ€§åˆ«å¾½ç«  */
        .gender-badge {
            width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; margin-left: 5px; vertical-align: middle;
        }
        .gender-male { background: #74b9ff; color: white; }
        .gender-female { background: #ff7675; color: white; }

        /* è¿”å›æŒ‰é’® */
        .back-btn {
            position: absolute; top: max(15px, env(safe-area-inset-top)); left: 15px; z-index: 10;
            background: rgba(255,255,255,0.2); backdrop-filter: blur(5px);
            width: 36px; height: 36px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white; text-decoration: none;
        }

        /* === ä¿¡æ¯å¡ç‰‡ === */
        .info-card {
            background: white; border-radius: 20px; padding: 20px; margin: -20px 15px 20px 15px;
            position: relative; z-index: 3;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        /* å¥åº·æ•°æ®æ ¼å­ */
        .health-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; }
        .health-item { background: #f8f9fa; border-radius: 12px; padding: 12px 5px; }
        .health-label { font-size: 11px; color: #999; margin-bottom: 2px; }
        .health-value { font-size: 16px; font-weight: bold; color: #333; }

        /* çŠ¶æ€ç‚¹ */
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 4px; }
        .dot-green { background: #00b894; }
        .dot-red { background: #ff7675; }

        /* === ç›¸å†Œç€‘å¸ƒæµ === */
        .gallery-title { margin: 20px 15px 10px; font-weight: bold; color: #333; font-size: 18px; }
        .gallery {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 15px;
        }
        .gallery-img {
            width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¤§å›¾åŒº -->
    <a href="/" class="back-btn"><i class="fas fa-arrow-left"></i></a>
    <div class="pet-header">
        <div class="header-content">
            <div>
                <div class="pet-name">
                    {{ pet.name }}
                    {% if pet.gender == 'male' %}<span class="gender-badge gender-male"><i class="fas fa-mars"></i></span>
                    {% elif pet.gender == 'female' %}<span class="gender-badge gender-female"><i class="fas fa-venus"></i></span>
                    {% endif %}
                </div>
                <div class="pet-meta">
                    ğŸ‚ {{ pet.age_display }}
                    {% if pet.type=='dog' %}| ğŸ¶ æ±ªæ˜Ÿäºº{% else %}| ğŸ± å–µæ˜Ÿäºº{% endif %}
                </div>
            </div>

            {% if pet.is_owner %}
            <button class="btn btn-light btn-sm rounded-pill fw-bold" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                <i class="fas fa-pen small me-1"></i>ç¼–è¾‘
            </button>
            {% endif %}
        </div>
    </div>

    <!-- å¥åº·æ•°æ®å¡ç‰‡ -->
    <div class="info-card">
        <div class="health-grid">
            <div class="health-item">
                <div class="health-label">âš–ï¸ ä½“é‡</div>
                <div class="health-value">{{ pet.weight or '--' }} <small>kg</small></div>
            </div>
            <div class="health-item">
                <div class="health-label">ğŸ’‰ ä¸Šæ¬¡ç–«è‹—</div>
                <div class="health-value" style="font-size: 14px; line-height: 24px;">
                    {{ pet.vaccine_date or 'æœªè®°å½•' }}
                </div>
            </div>
            <div class="health-item">
                <div class="health-label">ğŸ› ä¸Šæ¬¡é©±è™«</div>
                <div class="health-value" style="font-size: 14px; line-height: 24px;">
                    {{ pet.deworm_date or 'æœªè®°å½•' }}
                </div>
            </div>
        </div>
    </div>

    <!-- ç›¸å†Œæµ -->
    <div class="gallery-title">ğŸ“¸ æˆé•¿ç‚¹æ»´ ({{ pet.photos|length }})</div>
    <div class="gallery">
        {% for p in pet.photos %}
        <img src="{{ p.url }}" class="gallery-img" loading="lazy" onclick="window.open(this.src)">
        {% else %}
        <div class="text-center text-muted col-12 py-4">è¿˜æ²¡æœ‰ç…§ç‰‡å“¦ï¼Œå¿«å»é¦–é¡µæ‰“å¡å§</div>
        {% endfor %}
    </div>

    <!-- ç¼–è¾‘æ¡£æ¡ˆå¼¹çª— -->
    <div class="modal fade" id="editProfileModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 border-0">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">ğŸ“ å®Œå–„æ¡£æ¡ˆ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form action="/update_pet_detail" method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="hidden" name="pet_id" value="{{ pet.id }}">

                        <div class="mb-3">
                            <label class="form-label small text-muted">æ€§åˆ«</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="gender" id="g_male" value="male" {% if pet.gender=='male' %}checked{% endif %}>
                                <label class="btn btn-outline-primary" for="g_male">ğŸ’™ å¼Ÿå¼Ÿ</label>
                                <input type="radio" class="btn-check" name="gender" id="g_female" value="female" {% if pet.gender=='female' %}checked{% endif %}>
                                <label class="btn btn-outline-danger" for="g_female">ğŸ’– å¦¹å¦¹</label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small text-muted">ç”Ÿæ—¥</label>
                            <input type="date" name="birthday" class="form-control" value="{{ pet.birthday }}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label small text-muted">ä½“é‡ (kg)</label>
                            <input type="number" step="0.1" name="weight" class="form-control" value="{{ pet.weight }}" placeholder="0.0">
                        </div>

                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label small text-muted">ä¸Šæ¬¡ç–«è‹—</label>
                                <input type="date" name="vaccine_date" class="form-control" value="{{ pet.vaccine_date }}">
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label small text-muted">ä¸Šæ¬¡é©±è™«</label>
                                <input type="date" name="deworm_date" class="form-control" value="{{ pet.deworm_date }}">
                            </div>
                        </div>

                        <button class="btn btn-primary w-100 fw-bold rounded-3">ä¿å­˜æ¡£æ¡ˆ</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>